<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="it"
      th:replace="~{fragments/layout_new :: layout(~{::title}, ~{::body}, ~{::cssblock})}">
<head>
    <title>Corrispondenza â€“ Veely</title>

    <!-- Blocco CSS aggiuntivo solo per questa pagina -->
 		<th:block th:fragment="cssblock">
        <!-- CSS base AOS (serve oltre al tuo aos-custom.css nel layout) -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css">
        <style>
            /* Tabs */
            .modern-tabs {
                border-bottom: 1px solid var(--gray-200);
                gap: .25rem;
            }
            .modern-tabs .nav-link {
                border: 0;
                color: var(--gray-600);
                padding: .5rem .9rem;
                border-radius: var(--radius-md) var(--radius-md) 0 0;
                position: relative;
            }
            .modern-tabs .nav-link.active {
                color: var(--gray-900);
                background: var(--gray-50);
                font-weight: 600;
            }
            .modern-tabs .nav-link.active::after {
                content: '';
                position: absolute;
                left: 10px; right: 10px; bottom: -1px;
                height: 2px; background: var(--primary-500); border-radius: 2px;
            }

            /* Toolbar filtri */
            .table-toolbar { align-items: center; gap: 1rem; }
            .filter-row { margin-left: auto; display: flex; gap: .5rem; }
            .filter-row .form-control, .filter-row .btn, .filter-row .form-select { border-radius: var(--radius-md); }

            /* Colonna azioni compatta e allineata */
            .actions-col { width: 1%; white-space: nowrap; }
            .cell-actions a, .cell-actions form { display: inline-block; margin-left: .4rem; }
            .cell-actions a:first-child,
            .cell-actions form:first-child { margin-left: 0; }
            .cell-actions form { margin-bottom: 0; }
            .cell-actions .btn { padding: .25rem .45rem; }

            /* Descrizione & allegati */
            .desc-title { font-weight: 600; color: var(--gray-900); }
            .desc-sub { font-size: .85rem; color: var(--gray-500); }
            .note-text { color: var(--gray-700); }
            .attach-list a { display: inline-flex; align-items: center; gap: .35rem; margin-right: .5rem; }
            .attach-list i { font-size: 1rem; }
        </style>
    </th:block>
</head>

<body>
<main class="page-content">
    <div class="table-card fade-in" data-aos="fade-up" data-aos-delay="50">
        <!-- Header + Toolbar -->
        <div class="table-header table-toolbar">
            <div>
                <h2 class="table-title mb-0">Corrispondenza</h2>
                <p class="table-subtitle">Registra, cerca e scarica documenti di corrispondenza</p>
            </div>
            <a th:href="@{/correspondence/new}" class="btn btn-primary" data-aos="zoom-in">
                <i class="bi bi-plus-lg"></i> Nuova
            </a>
        </div>

        <!-- Tabs In Entrata / In Uscita -->
        <div class="px-3 pt-2" data-aos="fade-up" data-aos-delay="120">
            <ul class="nav nav-tabs modern-tabs">
                <li class="nav-item">
                    <a class="nav-link"
                       th:classappend="${(tab == 'in' or tab == null) ? ' active' : ''}"
                       th:href="@{/correspondence(tab='out', year=${year}, keyword=${param.keyword})}">
                        In Entrata
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link"
                       th:classappend="${(tab == 'out') ? ' active' : ''}"
                       th:href="@{/correspondence(tab='in', year=${year}, keyword=${param.keyword})}">
                        In Uscita
                    </a>
                </li>
            </ul>
        </div>

        <!-- Filtri -->
        <form class="px-3 pb-3 pt-3" method="get" th:action="@{/correspondence}" data-aos="fade-up" data-aos-delay="160">
            <input type="hidden" name="tab" th:value="${tab}">
            <div class="filter-row">
                <select name="year" class="form-select" style="width: 140px;">
                    <option value="">Anno</option>
                    <option th:each="y : ${years}" th:value="${y}" th:text="${y}"
                            th:selected="${year == y}"></option>
                </select>
                <div class="input-group" style="min-width: 280px;">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input type="text" name="keyword" class="form-control" th:value="${param.keyword}"
                           placeholder="Cerca per parola chiave...">
                </div>
                <button type="submit" class="btn btn-outline-secondary">
                    Filtra
                </button>
                <a th:href="@{/correspondence(tab=${tab})}" class="btn btn-outline-danger" title="Reset">
                    <i class="bi bi-x-lg"></i>
                </a>
            </div>
        </form>

        <!-- Tabella -->
        <div class="table-content modern-table" data-aos="fade-up" data-aos-delay="220">
            <table class="table align-middle mb-0">
                <thead>
                <tr>
                    <th style="width:1%;">#</th>
                    <th style="width:12%;">Data</th>
                    <th>Descrizione</th>
                    <th>Destinatario</th>
                    <th>Note</th>
                    <th class="text-end actions-col">Azioni</th>
                </tr>
                </thead>
                <tbody>
                <!-- ENTRATA -->
                <tr th:if="${tab == 'in' or tab == null}" th:each="c,stat : ${incoming}" class="table-row hover-animate">
                   <td th:text="${c.progressivo > 0 ? #numbers.formatInteger(c.progressivo,3) + '/' + c.anno : stat.count}">1</td>
                    <td th:text="${c.data != null ? #temporals.format(c.data,'dd/MM/yyyy') : ''}">16/07/2025</td>
                    <td>
                        <div class="desc-title" th:text="${c.descrizione}">Oggetto / Descrizione</div>
                        <div class="desc-sub" th:text="${c.sender}">Mittente</div>
                    </td>
                    <td th:text="${c.recipient}">Destinatario</td>
                    <td>
                        <div class="note-text" th:text="${c.notes}">Nota / testo</div>
                    </td>
                    <td class="text-end cell-actions actions-col">
                        <a th:href="@{|/correspondence/${c.id}/edit|}" class="btn btn-sm btn-outline-primary" title="Modifica">
                            <i class="bi bi-pencil"></i>
                        </a>
                        <form th:action="@{|/correspondence/${c.id}/delete|}" method="post" class="d-inline"
                              onsubmit="return confirm('Eliminare la voce selezionata?');">
                              <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                            <button type="submit" class="btn btn-sm btn-outline-danger" title="Elimina">
                                <i class="bi bi-trash"></i>
                            </button>
                        </form>
                    </td>
                </tr>

                <!-- USCITA -->
                <tr th:if="${tab == 'out'}" th:each="c,stat : ${outgoing}" class="table-row hover-animate">
                    <td th:text="${c.progressivo > 0 ? #numbers.formatInteger(c.progressivo,3) + '/' + c.anno : stat.count}">1</td>
                    <td th:text="${c.data != null ? #temporals.format(c.data,'dd/MM/yyyy') : ''}">16/07/2025</td>
                    <td>
                        <div class="desc-title" th:text="${c.descrizione}">Oggetto / Descrizione</div>
                        <div class="desc-sub" th:text="${c.sender}">Mittente</div>
                    </td>
                    <td th:text="${c.recipient}">Destinatario</td>
                    <td>
                        <div class="note-text" th:text="${c.notes}">Nota / testo</div>
                    </td>
                    <td class="text-end cell-actions actions-col">
                        <a th:href="@{|/correspondence/${c.id}/edit|}" class="btn btn-sm btn-outline-primary" title="Modifica">
                            <i class="bi bi-pencil"></i>
                        </a>
                        <form th:action="@{|/correspondence/${c.id}/delete|}" method="post" class="d-inline"
                              onsubmit="return confirm('Eliminare la voce selezionata?');">
                            <button type="submit" class="btn btn-sm btn-outline-danger" title="Elimina">
                                <i class="bi bi-trash"></i>
                            </button>
                        </form>
                    </td>
                </tr>

                <!-- EMPTY STATES -->
                <tr th:if="${#lists.isEmpty(incoming)} and (tab == 'in' or tab == null)" class="empty-row">
                    <td colspan="6">
                        <div class="empty-state">
                            <i class="bi bi-inbox"></i>
                            <span>Nessuna corrispondenza in entrata trovata.</span>
                        </div>
                    </td>
                </tr>
                <tr th:if="${#lists.isEmpty(outgoing)} and (tab == 'out')" class="empty-row">
                    <td colspan="6">
                        <div class="empty-state">
                            <i class="bi bi-send"></i>
                            <span>Nessuna corrispondenza in uscita trovata.</span>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

</main>

<!-- AOS JS -->
<script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
<script>AOS.init({ once: true, duration: 600, easing: 'ease-out' });</script>
</body>
</html>